<!DOCTYPE html>
<html lang=zh>
<head>
    <!-- so meta -->
    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="HandheldFriendly" content="True">
    <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1" />
    <meta name="description" content="Today we will walk through the small feature where you can click a butotn to open the camera roll on your cell phone and then select an image to show on the screen. Step 1: Check Runtime PermissionSin">
<meta name="keywords" content="image">
<meta property="og:type" content="article">
<meta property="og:title" content="4-Select Image from Camera Roll">
<meta property="og:url" content="http://yoursite.com/2018/01/11/4_Select_Image_from_Camera_Roll/index.html">
<meta property="og:site_name" content="走路草的博客">
<meta property="og:description" content="Today we will walk through the small feature where you can click a butotn to open the camera roll on your cell phone and then select an image to show on the screen. Step 1: Check Runtime PermissionSin">
<meta property="og:locale" content="zh-Hans">
<meta property="og:updated_time" content="2018-01-12T19:23:51.000Z">
<meta name="twitter:card" content="summary">
<meta name="twitter:title" content="4-Select Image from Camera Roll">
<meta name="twitter:description" content="Today we will walk through the small feature where you can click a butotn to open the camera roll on your cell phone and then select an image to show on the screen. Step 1: Check Runtime PermissionSin">
    
    
        
          
              <link rel="shortcut icon" href="/images/favicon.ico">
          
        
        
          
            <link rel="icon" type="image/png" href="/images/favicon-192x192.png" sizes="192x192">
          
        
        
          
            <link rel="apple-touch-icon" sizes="180x180" href="/images/apple-touch-icon.png">
          
        
    
    <!-- title -->
    <title>4-Select Image from Camera Roll</title>
    <!-- styles -->
    <link rel="stylesheet" href="/css/style.css">
    <!-- rss -->
    
    
</head>

<body>
    
      <div id="header-post">
  <a id="menu-icon" href="#"><i class="fa fa-bars fa-lg"></i></a>
  <a id="menu-icon-tablet" href="#"><i class="fa fa-bars fa-lg"></i></a>
  <a id="top-icon-tablet" href="#" onclick="$('html, body').animate({ scrollTop: 0 }, 'fast');" style="display:none;"><i class="fa fa-chevron-up fa-lg"></i></a>
  <span id="menu">
    <span id="nav">
      <ul>
         
          <li><a href="/">Home</a></li>
         
          <li><a href="/about/">About</a></li>
         
          <li><a href="/archives/">Writing</a></li>
         
          <li><a href="http://github.com/probberechts">Projects</a></li>
        
      </ul>
    </span>
    <br/>
    <span id="actions">
      <ul>
        
        <li><a class="icon" href="/2018/01/15/5-About-Simple-Picker/"><i class="fa fa-chevron-left" aria-hidden="true" onmouseover="$('#i-prev').toggle();" onmouseout="$('#i-prev').toggle();"></i></a></li>
        
        
        <li><a class="icon" href="/2018/01/11/3-Capture_Image/"><i class="fa fa-chevron-right" aria-hidden="true" onmouseover="$('#i-next').toggle();" onmouseout="$('#i-next').toggle();"></i></a></li>
        
        <li><a class="icon" href="#" onclick="$('html, body').animate({ scrollTop: 0 }, 'fast');"><i class="fa fa-chevron-up" aria-hidden="true" onmouseover="$('#i-top').toggle();" onmouseout="$('#i-top').toggle();"></i></a></li>
        <li><a class="icon" href="#"><i class="fa fa-share-alt" aria-hidden="true" onmouseover="$('#i-share').toggle();" onmouseout="$('#i-share').toggle();" onclick="$('#share').toggle();return false;"></i></a></li>
      </ul>
      <span id="i-prev" class="info" style="display:none;">Previous post</span>
      <span id="i-next" class="info" style="display:none;">Next post</span>
      <span id="i-top" class="info" style="display:none;">Back to top</span>
      <span id="i-share" class="info" style="display:none;">Share post</span>
    </span>
    <br/>
    <div id="share" style="display: none">
      <ul>
  <li><a class="icon" href="http://www.facebook.com/sharer.php?u=http://yoursite.com/2018/01/11/4_Select_Image_from_Camera_Roll/"><i class="fa fa-facebook " aria-hidden="true"></i></a></li>
  <li><a class="icon" href="https://twitter.com/share?url=http://yoursite.com/2018/01/11/4_Select_Image_from_Camera_Roll/&text=4-Select Image from Camera Roll"><i class="fa fa-twitter " aria-hidden="true"></i></a></li>
  <li><a class="icon" href="http://www.linkedin.com/shareArticle?url=http://yoursite.com/2018/01/11/4_Select_Image_from_Camera_Roll/&title=4-Select Image from Camera Roll"><i class="fa fa-linkedin " aria-hidden="true"></i></a></li>
  <li><a class="icon" href="https://pinterest.com/pin/create/bookmarklet/?url=http://yoursite.com/2018/01/11/4_Select_Image_from_Camera_Roll/&is_video=false&description=4-Select Image from Camera Roll"><i class="fa fa-pinterest " aria-hidden="true"></i></a></li>
  <li><a class="icon" href="mailto:?subject=4-Select Image from Camera Roll&body=Check out this article: http://yoursite.com/2018/01/11/4_Select_Image_from_Camera_Roll/"><i class="fa fa-envelope " aria-hidden="true"></i></a></li>
  <li><a class="icon" href="https://getpocket.com/save?url=http://yoursite.com/2018/01/11/4_Select_Image_from_Camera_Roll/&title=4-Select Image from Camera Roll"><i class="fa fa-get-pocket " aria-hidden="true"></i></a></li>
  <li><a class="icon" href="http://reddit.com/submit?url=http://yoursite.com/2018/01/11/4_Select_Image_from_Camera_Roll/&title=4-Select Image from Camera Roll"><i class="fa fa-reddit " aria-hidden="true"></i></a></li>
  <li><a class="icon" href="http://www.stumbleupon.com/submit?url=http://yoursite.com/2018/01/11/4_Select_Image_from_Camera_Roll/&title=4-Select Image from Camera Roll"><i class="fa fa-stumbleupon " aria-hidden="true"></i></a></li>
  <li><a class="icon" href="http://digg.com/submit?url=http://yoursite.com/2018/01/11/4_Select_Image_from_Camera_Roll/&title=4-Select Image from Camera Roll"><i class="fa fa-digg " aria-hidden="true"></i></a></li>
  <li><a class="icon" href="http://www.tumblr.com/share/link?url=http://yoursite.com/2018/01/11/4_Select_Image_from_Camera_Roll/&name=4-Select Image from Camera Roll&description="><i class="fa fa-tumblr " aria-hidden="true"></i></a></li>
</ul>

    </div>
    <div id="toc">
      <ol class="toc"><li class="toc-item toc-level-2"><a class="toc-link" href="#Step-1-Check-Runtime-Permission"><span class="toc-number">1.</span> <span class="toc-text">Step 1: Check Runtime Permission</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#Step-2-Create-Intent-and-Start-Activity"><span class="toc-number">2.</span> <span class="toc-text">Step 2: Create Intent and Start Activity</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#Step-3-Implement-the-OnActivityResult"><span class="toc-number">3.</span> <span class="toc-text">Step 3: Implement the OnActivityResult</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#Step-4-HandlImage"><span class="toc-number">4.</span> <span class="toc-text">Step 4: HandlImage</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#Before-KitKat-Android-4-4"><span class="toc-number">4.1.</span> <span class="toc-text">Before KitKat (Android 4.4)</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#After-KitKat-Android-4-4"><span class="toc-number">4.2.</span> <span class="toc-text">After KitKat (Android 4.4)</span></a></li></ol></li></ol>
    </div>
  </span>
</div>

    
    <div class="content index width mx-auto px2 my4">
        
        <article class="post" itemscope itemtype="http://schema.org/BlogPosting">
  <header>
    
    <h1 class="posttitle" itemprop="name headline">
        4-Select Image from Camera Roll
    </h1>



    <div class="meta">
      <span class="author" itemprop="author" itemscope itemtype="http://schema.org/Person">
        <span itemprop="name">走路草的博客</span>
      </span>
      
    <div class="postdate">
        <time datetime="2018-01-12T06:19:43.000Z" itemprop="datePublished">2018-01-11</time>
    </div>


      
    <div class="article-tag">
        <i class="fa fa-tag"></i>
        <a class="tag-link" href="/tags/image/">image</a>
    </div>


    </div>
  </header>
  

  <div class="content" itemprop="articleBody">
    <p>Today we will walk through the small feature where you can click a butotn to open the camera roll on your cell phone and then select an image to show on the screen.</p>
<h2 id="Step-1-Check-Runtime-Permission"><a href="#Step-1-Check-Runtime-Permission" class="headerlink" title="Step 1: Check Runtime Permission"></a>Step 1: Check Runtime Permission</h2><p>Since we need to read an image from SD card and this is a critical permission so we have to check and ask for it in runtime. The permission is WRITE_EXTERNAL_STORAGE. Although it says ‘write’, it gives both read and write permission at the same time. </p>
<pre><code> if (ContextCompat.checkSelfPermission(
    HelloWorldActivity.this,
            android.Manifest.permission.WRITE_EXTERNAL_STORAGE) !=
                PackageManager.PERMISSION_GRANTED) {
              ActivityCompat.requestPermissions(HelloWorldActivity.this,
              new String[]{android.Manifest.permission.WRITE_EXTERNAL_STORAGE}, 1);
    } else {
    doSomething();
}
</code></pre><p>Note that when you request for the permission, we send a ‘1’. This is similar to the requestCode used in Intent. It is needed in the ‘onRequestPermissionsResult’ to identify which request it is.</p>
<p>Then of course we need to implement the ‘onRequestPermissionsResult’ to do whatever we are supposed to do before we check the permission. </p>
<pre><code>@Override
 public void onRequestPermissionsResult(int requestCode, @NonNull String[] permissions, @NonNull int[] grantResults) {
       switch (requestCode) {
             case 1:
               if (grantResults.length &gt; 0 &amp;&amp; grantResults[0] == PackageManager.PERMISSION_GRANTED) {
                     doSomething();
               } else {
                     Toast.makeText(this, &quot;Permission Denied&quot;, Toast.LENGTH_SHORT).show();
                 }
             break;
             default:
       }
 }
</code></pre><h2 id="Step-2-Create-Intent-and-Start-Activity"><a href="#Step-2-Create-Intent-and-Start-Activity" class="headerlink" title="Step 2: Create Intent and Start Activity"></a>Step 2: Create Intent and Start Activity</h2><p>Next step we need implement the logic in ‘doSomething()’. First thing is to create an Intent that can open the amera roll.</p>
<pre><code>private void openCameraRoll() {
    Intent intent = new Intent(&quot;android.intent.action.GET_CONTENT&quot;);
        intent.setType(&quot;image/*&quot;);
        startActivityForResult(intent, CHOOSE_PHOTO);
  } 
</code></pre><h2 id="Step-3-Implement-the-OnActivityResult"><a href="#Step-3-Implement-the-OnActivityResult" class="headerlink" title="Step 3: Implement the OnActivityResult"></a>Step 3: Implement the OnActivityResult</h2><p>In the on ActivityResult, we will need to check for the requestCode(CHOOSE_PHOTO) and the respondCode(RESULT_OK).<br>What we have in the ‘OnActivityResult’ is an Intent. Next we are going to see how we can use this Intent to get our Bitmap that can be attached to the ImageView.</p>
<h2 id="Step-4-HandlImage"><a href="#Step-4-HandlImage" class="headerlink" title="Step 4: HandlImage"></a>Step 4: HandlImage</h2><p>To translate the Intent to an Bitmap, we will need to separate it into 2 cases:</p>
<h3 id="Before-KitKat-Android-4-4"><a href="#Before-KitKat-Android-4-4" class="headerlink" title="Before KitKat (Android 4.4)"></a>Before KitKat (Android 4.4)</h3><p>Before Android 4.4, we used to be able to get the full Uri of the image. Then we can get the path of the image, and then decode the path to a Bitmap that can be attached to a view.</p>
<pre><code>private void handleImageBeforeKitKat(Intent data) {
        Uri uri = data.getData();
        String imagePath = getImagePath(uri, null);
        displayImage(imagePath);
  }    

  private void displayImage(String imagePath) {
        if (imagePath != null) {
              Bitmap bitmap = BitmapFactory.decodeFile(imagePath);
              mImage.setImageBitmap(bitmap);
        } else {
              Toast.makeText(this, &quot;failed to get picture!&quot;, Toast.LENGTH_SHORT).show();
        }
  }

  private String getImagePath(Uri uri, String selection) {
        String path = null;
        Cursor cursor = getContentResolver().query(uri, null, selection, null, null);
        if (cursor != null) {
              if (cursor.moveToFirst()) {
                path = cursor.getString(cursor.getColumnIndex(MediaStore.Images.Media.DATA));
          }
              cursor.close();
        }
        return path;
  }
</code></pre><p>Note that when we have Uri, it means we have the locator and able to get it from SD card.</p>
<h3 id="After-KitKat-Android-4-4"><a href="#After-KitKat-Android-4-4" class="headerlink" title="After KitKat (Android 4.4)"></a>After KitKat (Android 4.4)</h3><p>After Android 4.4, it is considered to be not safe to return a full Uri so a encapsulated Uri is returned. We will have to decode the encapsulated Uri to get the Bitmap. It could be of document type (use document id), or content type (query database using uri) or file type (directly get the file path). </p>
<pre><code>@TargetApi(19)
  private void handleImageOnKitKat(Intent data) {
        String imagePath = null;
        Uri uri = data.getData(); // This is encapsulated. need to decode it.
        if (DocumentsContract.isDocumentUri(this, uri)) {
              String docId = DocumentsContract.getDocumentId(uri);
              if (&quot;com.android.providers.media.documents&quot;.equals(uri.getAuthority())) {
                String id = docId.split(&quot;:&quot;)[1];
                String selection = MediaStore.Images.Media._ID + &quot;=&quot; + id;
                    imagePath = getImagePath(MediaStore.Images.Media.EXTERNAL_CONTENT_URI, selection);
              } else if (&quot;com.android.providers.downloads.documents&quot;.equals(uri.getAuthority())) {
                Uri contentUri = ContentUris.withAppendedId(
                            Uri.parse(&quot;content://downloads/public_downloads&quot;), Long.valueOf(docId));
                    imagePath = getImagePath(contentUri, null);
              }
           } else if (&quot;content&quot;.equalsIgnoreCase(uri.getScheme())) {
              imagePath = getImagePath(uri, null);
        } else if (&quot;file&quot;.equalsIgnoreCase(uri.getScheme())) {
              imagePath = uri.getPath();
        }
        displayImage(imagePath);
  }
</code></pre>
  </div>
</article>



    </div>
    
      <div id="footer-post-container">
  <div id="footer-post">

    <div id="nav-footer" style="display: none">
      <ul>
         
          <li><a href="/">Home</a></li>
         
          <li><a href="/about/">About</a></li>
         
          <li><a href="/archives/">Writing</a></li>
         
          <li><a href="http://github.com/probberechts">Projects</a></li>
        
      </ul>
    </div>

    <div id="toc-footer" style="display: none">
      <ol class="toc"><li class="toc-item toc-level-2"><a class="toc-link" href="#Step-1-Check-Runtime-Permission"><span class="toc-number">1.</span> <span class="toc-text">Step 1: Check Runtime Permission</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#Step-2-Create-Intent-and-Start-Activity"><span class="toc-number">2.</span> <span class="toc-text">Step 2: Create Intent and Start Activity</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#Step-3-Implement-the-OnActivityResult"><span class="toc-number">3.</span> <span class="toc-text">Step 3: Implement the OnActivityResult</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#Step-4-HandlImage"><span class="toc-number">4.</span> <span class="toc-text">Step 4: HandlImage</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#Before-KitKat-Android-4-4"><span class="toc-number">4.1.</span> <span class="toc-text">Before KitKat (Android 4.4)</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#After-KitKat-Android-4-4"><span class="toc-number">4.2.</span> <span class="toc-text">After KitKat (Android 4.4)</span></a></li></ol></li></ol>
    </div>

    <div id="share-footer" style="display: none">
      <ul>
  <li><a class="icon" href="http://www.facebook.com/sharer.php?u=http://yoursite.com/2018/01/11/4_Select_Image_from_Camera_Roll/"><i class="fa fa-facebook fa-lg" aria-hidden="true"></i></a></li>
  <li><a class="icon" href="https://twitter.com/share?url=http://yoursite.com/2018/01/11/4_Select_Image_from_Camera_Roll/&text=4-Select Image from Camera Roll"><i class="fa fa-twitter fa-lg" aria-hidden="true"></i></a></li>
  <li><a class="icon" href="http://www.linkedin.com/shareArticle?url=http://yoursite.com/2018/01/11/4_Select_Image_from_Camera_Roll/&title=4-Select Image from Camera Roll"><i class="fa fa-linkedin fa-lg" aria-hidden="true"></i></a></li>
  <li><a class="icon" href="https://pinterest.com/pin/create/bookmarklet/?url=http://yoursite.com/2018/01/11/4_Select_Image_from_Camera_Roll/&is_video=false&description=4-Select Image from Camera Roll"><i class="fa fa-pinterest fa-lg" aria-hidden="true"></i></a></li>
  <li><a class="icon" href="mailto:?subject=4-Select Image from Camera Roll&body=Check out this article: http://yoursite.com/2018/01/11/4_Select_Image_from_Camera_Roll/"><i class="fa fa-envelope fa-lg" aria-hidden="true"></i></a></li>
  <li><a class="icon" href="https://getpocket.com/save?url=http://yoursite.com/2018/01/11/4_Select_Image_from_Camera_Roll/&title=4-Select Image from Camera Roll"><i class="fa fa-get-pocket fa-lg" aria-hidden="true"></i></a></li>
  <li><a class="icon" href="http://reddit.com/submit?url=http://yoursite.com/2018/01/11/4_Select_Image_from_Camera_Roll/&title=4-Select Image from Camera Roll"><i class="fa fa-reddit fa-lg" aria-hidden="true"></i></a></li>
  <li><a class="icon" href="http://www.stumbleupon.com/submit?url=http://yoursite.com/2018/01/11/4_Select_Image_from_Camera_Roll/&title=4-Select Image from Camera Roll"><i class="fa fa-stumbleupon fa-lg" aria-hidden="true"></i></a></li>
  <li><a class="icon" href="http://digg.com/submit?url=http://yoursite.com/2018/01/11/4_Select_Image_from_Camera_Roll/&title=4-Select Image from Camera Roll"><i class="fa fa-digg fa-lg" aria-hidden="true"></i></a></li>
  <li><a class="icon" href="http://www.tumblr.com/share/link?url=http://yoursite.com/2018/01/11/4_Select_Image_from_Camera_Roll/&name=4-Select Image from Camera Roll&description="><i class="fa fa-tumblr fa-lg" aria-hidden="true"></i></a></li>
</ul>

    </div>

    <div id="actions-footer">
      <ul>
        <li id="toc"><a class="icon" href="#" onclick="$('#toc-footer').toggle();return false;"><i class="fa fa-list fa-lg" aria-hidden="true"></i> TOC</a></li>
        <li id="share"><a class="icon" href="#" onclick="$('#share-footer').toggle();return false;"><i class="fa fa-share-alt fa-lg" aria-hidden="true"></i> Share</a></li>
        <li id="top" style="display:none"><a class="icon" href="#" onclick="$('html, body').animate({ scrollTop: 0 }, 'fast');"><i class="fa fa-chevron-up fa-lg" aria-hidden="true"></i> Top</a></li>
        <li id="menu"><a class="icon" href="#" onclick="$('#nav-footer').toggle();return false;"><i class="fa fa-bars fa-lg" aria-hidden="true"></i> Menu</a></li>
      </ul>
    </div>

  </div>
</div>

    
    <footer id="footer">
  <div class="footer-left">
    Copyright &copy; 2018 走路草
  </div>
  <div class="footer-right">
    <nav>
      <ul>
         
          <li><a href="/">Home</a></li>
         
          <li><a href="/about/">About</a></li>
         
          <li><a href="/archives/">Writing</a></li>
         
          <li><a href="http://github.com/probberechts">Projects</a></li>
        
      </ul>
    </nav>
  </div>
</footer>

</body>
</html>
<!-- styles -->
<link rel="stylesheet" href="/lib/font-awesome/css/font-awesome.min.css">
<link rel="stylesheet" href="/lib/meslo-LG/styles.css">
<link rel="stylesheet" href="/lib/justified-gallery/justifiedGallery.min.css">

<!-- jquery -->
<script src="/lib/jquery/jquery.min.js"></script>
<script src="/lib/justified-gallery/jquery.justifiedGallery.min.js"></script>
<script src="/js/main.js"></script>
<!-- search -->

<!-- Google Analytics -->

    <script type="text/javascript">
        (function(i,s,o,g,r,a,m) {i['GoogleAnalyticsObject']=r;i[r]=i[r]||function() {
        (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
        m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
        })(window,document,'script','//www.google-analytics.com/analytics.js','ga');
        ga('create', 'UA-86660611-1', 'auto');
        ga('send', 'pageview');
    </script>

<!-- Disqus Comments -->


